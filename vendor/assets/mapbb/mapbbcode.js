/*
 JavaScript library for [map] BBCode parsing, displaying and editing.
 Version 1.0.0
 https://github.com/MapBBCode/mapbbcode
 (c) 2013, Ilya Zverev
 Licensed WTFPL.
*/
!function(window,document,undefined){L=window.L,window.MapBBCodeProcessor={decimalDigits:5,_getRegExp:function(){var t="\\s*(-?\\d+(?:\\.\\d+)?)\\s*,\\s*(-?\\d+(?:\\.\\d+)?)",e="\\((?:([a-zA-Z0-9,]*)\\|)?(|[\\s\\S]*?[^\\\\])\\)",o=t+"(?:"+t+")*(?:\\s*"+e+")?",n="\\[map(?:=([12]?\\d)(?:,"+t+")?)?\\]",i=n+"("+o+"(?:\\s*;"+o+")*)?\\s*\\[/map\\]",a=new RegExp(i,"i");return{coord:t,params:e,map:i,mapCompiled:a}},isValid:function(t){return this._getRegExp().mapCompiled.test(t)},stringToObjects:function(t){var e=this._getRegExp(),o=t.match(e.mapCompiled),n={objs:[]};if(o&&o[1]&&o[1].length&&+o[1]>0&&(n.zoom=+o[1],o[3]&&o[3].length>0))try{n.pos=L.LatLng?new L.LatLng(o[2],o[3]):[+o[2],+o[3]]}catch(i){}if(o&&o[4])for(var a=o[4].replace(/;;/g,"##%##").split(";"),r=new RegExp("^"+e.coord),s=new RegExp(e.params),l=0;l<a.length;l++){var d,p=a[l].replace(/##%##/g,";"),c=[],h="",u=[];for(d=p.match(r);d;)c.push(L.LatLng?new L.LatLng(d[1],d[2]):[+d[1],+d[2]]),p=p.substr(d[0].length),d=p.match(r);d=p.match(s),d&&(d[1]&&(u=d[1].split(",")),h=d[2].replace(/\\\)/g,")").replace(/^\s+|\s+$/g,"")),n.objs.push({coords:c,text:h,params:u})}return n},objectsToString:function(t){var e="";t.zoom>0&&(e="="+t.zoom,t.pos&&(e+=","+this._latLngToString(t.pos)));for(var o=[],n=[],i=t.objs||[],a=0;a<i.length;a++){for(var r=i[a].coords,s="",l=0;l<r.length;l++)l>0&&(s+=" "),s+=this._latLngToString(r[l]);var d=i[a].text||"",p=i[a].params||[];d.indexOf("|")>=0&&0===p.length&&(d="|"+d),(d.length>0||p.length>0)&&(s=s+"("+(p.length>0?p.join(",")+"|":"")+d.replace(/\)/g,"\\)").replace(/;/g,";;")+")"),r.length&&(1==r.length?o.push(s):n.push(s))}return o.length||n.length||e.length?"[map"+e+"]"+o.concat(n).join("; ")+"[/map]":""},_latLngToString:function(t){var e=Math.pow(10,this.decimalDigits);return""+Math.round((t.lat||t[0])*e)/e+","+Math.round((t.lng||t[1])*e)/e}},window.MapBBCode=L.Class.extend({options:{createLayers:null,layers:null,maxInitialZoom:15,defaultPosition:[22,11],defaultZoom:2,leafletOptions:{},polygonOpacity:.1,editorHeight:400,viewWidth:600,viewHeight:300,fullViewHeight:600,fullScreenButton:!0,fullFromStart:!1,windowWidth:800,windowHeight:500,windowFeatures:"resizable,status,dialog",windowPath:"lib/mapbbcode-window.html",editorCloseButtons:!0,confirmFormSubmit:!0,outerLinkTemplate:!1,helpButton:!0,allowedHTML:"[auib]|span|br|em|strong|tt",letterIconLength:2,popupIconLength:30,enablePolygons:!0,preferStandardLayerSwitcher:!0,decimalDigits:5,hideInsideClasses:[],externalEndpoint:"http://share.mapbbcode.org/",uploadButton:!1,shareTag:"mapid"},strings:{},initialize:function(t){L.setOptions(this,t),L.Browser.ie&&t&&t.defaultPosition&&"splice"in t.defaultPosition&&2==t.defaultPosition.length&&(this.options.defaultPosition=[t.defaultPosition[0],t.defaultPosition[1]])},setStrings:function(t){this.strings=L.extend({},this.strings,t)},_eachParamHandler:function(t,e,o){var n=window.MapBBCode.objectParams;if(n)for(var i=0;i<n.length;i++)(!o||n[i].applicableTo(o))&&t.call(e||this,n[i])},_objectToLayer:function(t){var e;return 1==t.coords.length?e=L.marker(t.coords[0]):t.coords.length>2&&t.coords[0].equals(t.coords[t.coords.length-1])?(t.coords.splice(t.coords.length-1,1),e=L.polygon(t.coords,{weight:3,opacity:.7,fill:!0,fillOpacity:this.options.polygonOpacity})):e=L.polyline(t.coords,{weight:5,opacity:.7}),this._eachParamHandler(function(o){for(var n=[],i=0;i<t.params.length;i++)o.reKeys.test(t.params[i])&&n.push(t.params[i]);o.objectToLayer(e,o.text?t.text:n,this)},this,e),e._objParams=t.params,e},_zoomToLayer:function(t,e,o,n){var i=e.getBounds();if(!i||!i.isValid())return o&&o.zoom?t.setView(o.pos||this.options.defaultPosition,o.zoom):n&&t.setView(this.options.defaultPosition,this.options.defaultZoom),void 0;var a=function(){if(o&&o.pos)t.setView(o.pos,o.zoom||this.options.maxInitialZoom);else{var e=Math.max(this.options.maxInitialZoom,n?0:t.getZoom());t.fitBounds(i,{animate:!1}),o&&o.zoom?t.setZoom(o.zoom,{animate:!1}):t.getZoom()>e&&t.setZoom(e,{animate:!1})}},r=t.getBoundsZoom(i,!1);r?a.call(this):t.on("load",a,this)},createOpenStreetMapLayer:function(){return L.tileLayer("http://tile.openstreetmap.org/{z}/{x}/{y}.png",{name:"OpenStreetMap",attribution:'Map &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>',minZoom:2,maxZoom:18})},_addLayers:function(t){var e=this.options.createLayers?this.options.createLayers.call(this,L):null;if(e&&e.length||!window.layerList||!this.options.layers||(e=window.layerList.getLeafletLayers(this.options.layers,L)),e&&e.length||(e=[this.createOpenStreetMapLayer()]),t.addLayer(e[0]),e.length>1){var o,n;if(!this.options.preferStandardLayerSwitcher&&L.StaticLayerSwitcher){for(o=L.staticLayerSwitcher(),n=0;n<e.length;n++)o.addLayer(e[n].options.name,e[n]);t.addControl(o)}else{for(o=L.control.layers(),n=0;n<e.length;n++)o.addBaseLayer(e[n],e[n].options.name);t.addControl(o)}}},_hideClassPresent:function(t){if("string"!=typeof t.className)return!1;var e,o,n=t.className.split(" "),i=this.options.hideInsideClasses;if(!i||!i.length)return!1;for(e=0;e<n.length;e++)for(o=0;o<i.length;o++)if(n[e]===i[o])return!0;return t.parentNode&&this._hideClassPresent(t.parentNode)},_px:function(t){return t?t+"px":"100%"},_createMapPanel:function(t,e){var o="string"==typeof t?document.getElementById(t):t;if(o){for(var n=o.getAttribute("bbcode")||o.getAttribute("value")||o.innerHTML.replace(/^\s+|\s+$/g,"");o.firstChild;)o.removeChild(o.firstChild);if(e||!this._hideClassPresent(o)){var i=document.createElement("div");return i.style.width=e?"100%":this.options.fullFromStart?"100%":this._px(this.options.viewWidth),i.style.height=e?this._px(this.options.editorHeight):this.options.fullFromStart?this._px(this.options.fullViewHeight):this._px(this.options.viewHeight),o.appendChild(i),i.storedBBCode=n,i.close=function(){o.removeChild(i)},i}}},show:function(t,e){var o=this._createMapPanel(t);if(o&&(e||(e=o.storedBBCode),e&&"string"==typeof e)){var n=L.map(o,L.extend({},{scrollWheelZoom:!1,zoomControl:!1},this.options.leafletOptions));n.addControl(new L.Control.Zoom({zoomInTitle:this.strings.zoomInTitle,zoomOutTitle:this.strings.zoomOutTitle})),this._addLayers(n);var i=new L.FeatureGroup;i.addTo(n);for(var a=window.MapBBCodeProcessor.stringToObjects(e),r=a.objs,s=0;s<r.length;s++)this._objectToLayer(r[s]).addTo(i);if(this._zoomToLayer(n,i,{zoom:a.zoom,pos:a.pos},!0),this.options.fullScreenButton&&!this.options.fullFromStart){var l,d=new L.FunctionButton(window.MapBBCode.buttonsImage,{position:"topright",bgPos:[0,0],title:this.strings.fullScreenTitle}),p=!1;n.addControl(d),d.on("clicked",function(){var t=n.getContainer().style;p||l||(l=[t.width,t.height]),p=!p,t.width=p?"100%":l[0],t.height=p?this._px(this.options.fullViewHeight):l[1],n.invalidateSize(),d.setBgPos([p?26:0,0]);var e=p?1:-1;n.setZoom(n.getZoom()+e,{animate:!1})},this)}if(this.options.outerLinkTemplate&&"http"==this.options.outerLinkTemplate.substring(0,4)){var c=L.functionButton(window.MapBBCode.buttonsImage,{position:"topright",bgPos:[52,0],title:this.strings.outerTitle});c.on("clicked",function(){var t=this.options.outerLinkTemplate;t=t.replace("{zoom}",n.getZoom()).replace("{lat}",n.getCenter().lat).replace("{lon}",n.getCenter().lng),window.open(t,"mapbbcode_outer")},this),n.addControl(c)}return{_ui:this,map:n,close:function(){this.map=null,this._ui=null,o.close()},getBBCode:function(){return e},updateBBCode:function(t,o){e=t;var a=window.MapBBCodeProcessor.stringToObjects(e),r=a.objs;i.clearLayers();for(var s=0;s<r.length;s++)this._ui._objectToLayer(r[s]).addTo(i);o||this._ui._zoomToLayer(n,i,{zoom:a.zoom,pos:a.pos},!0)},zoomToData:function(){this._ui._zoomToLayer(n,i)}}}}}),L.FunctionButtons=L.Control.extend({includes:L.Mixin.Events,initialize:function(t,e){if(this._content=t,e.titles||(e.titles=[]),e.titles.length<t.length)for(var o=e.titles.length;o<t.length;o++)e.titles.push("");L.Control.prototype.initialize.call(this,e)},onAdd:function(t){this._map=t,this._links=[];for(var e=L.DomUtil.create("div","leaflet-bar"),o=0;o<this._content.length;o++){var n=L.DomUtil.create("a","",e);this._links.push(n),n.href="#",n.style.padding="0 4px",n.style.width="auto",n.style.minWidth="20px",this.options.titles&&this.options.titles.length>o&&(n.title=this.options.titles[o]),this._updateContent(o);var i=L.DomEvent.stopPropagation;L.DomEvent.on(n,"click",i).on(n,"mousedown",i).on(n,"dblclick",i).on(n,"click",L.DomEvent.preventDefault).on(n,"click",this.clicked,this)}return e},_updateContent:function(t){if(!(t>=this._content.length)){var e=this._links[t],o=this._content[t];if("string"==typeof o){var n=o.length<4?"":o.substring(o.length-4),i="data:image/"===o.substring(0,11);".png"===n||".gif"===n||".jpg"===n||i?(e.style.width=""+(this.options.imageSize||26)+"px",e.style.height=""+(this.options.imageSize||26)+"px",e.style.padding="0",e.style.backgroundImage="url("+o+")",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition=this.options.bgPos&&this.options.bgPos.length>t&&this.options.bgPos[t]?-this.options.bgPos[t][0]+"px "+-this.options.bgPos[t][1]+"px":"0px 0px"):e.innerHTML=o}else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(o)}}},setContent:function(t,e){t>=this._content.length||(this._content[t]=e,this._updateContent(t))},setTitle:function(t,e){this.options.titles[t]=e,this._links[t].title=e},setBgPos:function(t,e){this.options.bgPos[t]=e,this._links[t].style.backgroundPosition=e?-e[0]+"px "+-e[1]+"px":"0px 0px"},clicked:function(t){for(var e=window.event&&window.event.srcElement||t.target||t.srcElement,o=this._links.length;--o>=0&&e!==this._links[o];);this.fire("clicked",{idx:o})}}),L.functionButtons=function(t,e){return new L.FunctionButtons(t,e)},L.FunctionButton=L.FunctionButtons.extend({initialize:function(t,e){e.title&&(e.titles=[e.title]),e.bgPos&&(e.bgPos=[e.bgPos]),L.FunctionButtons.prototype.initialize.call(this,[t],e)},setContent:function(t){L.FunctionButtons.prototype.setContent.call(this,0,t)},setTitle:function(t){L.FunctionButtons.prototype.setTitle.call(this,0,t)},setBgPos:function(t){L.FunctionButtons.prototype.setBgPos.call(this,0,t)}}),L.functionButton=function(t,e){return new L.FunctionButton(t,e)},window.MapBBCode.buttonsImage="data:image/png;base64,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","objectParams"in window.MapBBCode||(window.MapBBCode.objectParams=[]),window.MapBBCode.objectParams.unshift({text:!0,reKeys:new RegExp("a^"),applicableTo:function(){return!0},objectToLayer:function(t,e,o){if(e){t._text=e;var n=this._getIcon(t,e,o);n?(t.setIcon(n),t.options.clickable=!1):t.bindPopup(e.replace(new RegExp("<(?!/?("+o.options.allowedHTML+")[ >])","g"),"&lt;"))}else t.options.clickable=!1},_getIcon:function(t,e,o){if(t instanceof L.Marker&&e.length>0){if(L.LetterIcon&&e.length<=o.options.letterIconLength)return new L.LetterIcon(e);if(L.PopupIcon&&e.length<=o.options.popupIconLength&&e.indexOf("<")<0)return new L.PopupIcon(e)}},layerToObject:function(t){return t.inputField?t.inputField.value.replace(/\\n/g,"\n").replace(/\\\n/g,"\\n"):t._text||""},createEditorPanel:function(t,e){if(t instanceof L.Marker){var o=document.createElement("div"),n=document.createTextNode(e.strings.title+": "),i=document.createElement("input");return i.type="text",i.size=20,t._text&&(i.value=t._text.replace(/\\n/g,"\\\\n").replace(/[\r\n]+/g,"\\n")),o.appendChild(n),o.appendChild(i),o.style.marginBottom="8px",t.inputField=i,t.options.draggable=!0,t.defaultIcon=new L.Icon.Default,i.onkeypress=function(e){var o=window.event?(e||window.event).which:e.keyCode;return 27==o||13==o?(t.closePopup(),e.preventDefault(),!1):void 0},t.on("popupopen",function(){i.focus()}),t.on("popupclose",function(){var o=t.inputField.value,n=this._getIcon(t,o,e)||t.defaultIcon;t.setIcon(n)},this),o}}}),window.MapBBCode.include({_layerToObject:function(t){var e={};if(t instanceof L.Marker)e.coords=[t.getLatLng()];else{var o,n=t.getLatLngs(),i=n.length,a=[];for(o=0;i>o;o++)a.push(n[o]);t instanceof L.Polygon&&a.push(a[0]),e.coords=a}return e.params=t._objParams||[],this._eachParamHandler(function(o){if(o.text){var n=o.layerToObject(t,"",this);n&&(e.text=n)}else{var i,a=[];for(i=e.params.length-1;i>=0;i--)o.reKeys.test(e.params[i])&&a.unshift(e.params.splice(i,1));var r=o.layerToObject(t,a,this);if(r&&r.length>0)for(i=0;i<r.length;i++)e.params.push(r[i])}},this,t),e},_makeEditable:function(t,e){var o=document.createElement("div");o.style.textAlign="center",o.style.clear="both";var n=document.createElement("input");if(n.type="button",n.value=this.strings.close,n.onclick=function(){t.closePopup()},o.appendChild(n),e){var i=document.createElement("input");i.type="button",i.value=this.strings.remove,i.onclick=function(){t.closePopup(),e.removeLayer(t)},o.appendChild(i)}var a=document.createElement("div");return t.options.clickable=!0,(t instanceof L.Polyline||t instanceof L.Polygon)&&t.editing.enable(),this._eachParamHandler(function(e){var o=e.createEditorPanel?e.createEditorPanel(t,this):null;o&&a.appendChild(o)},this,t),a.appendChild(o),t.bindPopup(a),t},_findParentForm:function(t){for(var e=t;e&&"FORM"!=e.tagName&&"HTML"!=e.tagName;)e=e.parentElement;return e&&"FORM"==e.tagName?e:!1},_addSubmitHandler:function(t,e){var o=this._getBBCode(t,e),n=this._findParentForm(t.getContainer());n&&L.DomEvent.on(n,"submit",function(n){if(this._findParentForm(t.getContainer())){var i=this._getBBCode(t,e);i!=o&&e.getLayers().length>0&&(window.confirm(this.strings.submitWarning)||L.DomEvent.preventDefault(n))}},this)},_findMapInTextArea:function(t){var e=t.value,o="selectionStart"in t?t.selectionStart:e.indexOf("[/map]");if(o>=e.length||e.length<10||e.indexOf("[/map]")<0)return"";var n=e.lastIndexOf("[map",o);if(n>=0){var i=e.indexOf("[/map]",n);if(i+5>=o){var a=e.substring(n,i+6);if(window.MapBBCodeProcessor.isValid(a))return a}}return""},_updateMapInTextArea:function(t,e,o){var n=t.selectionStart,i=t.value;t.value=e.length&&i.indexOf(e)>=0?i.replace(e,o):!("selectionStart"in t)||n>=i.length?i+o:i.substring(0,n)+o+i.substring(n)},_getBBCode:function(t,e){var o=[];return e.eachLayer(function(t){o.push(this._layerToObject(t))},this),window.MapBBCodeProcessor.decimalDigits=this.options.decimalDigits,window.MapBBCodeProcessor.objectsToString({objs:o,zoom:o.length?0:t.getZoom(),pos:o.length?0:t.getCenter()})},editor:function(t,e,o,n){var i=this._createMapPanel(t,!0);if(i){var a=L.map(i,L.extend({},{zoomControl:!1},this.options.leafletOptions));a.addControl(new L.Control.Zoom({zoomInTitle:this.strings.zoomInTitle,zoomOutTitle:this.strings.zoomOutTitle})),L.Control.Search&&a.addControl(new L.Control.Search),this._addLayers(a);var r;"string"!=typeof e&&(r=e,e=this._findMapInTextArea(r));for(var s=new L.FeatureGroup,l=window.MapBBCodeProcessor.stringToObjects(e),d=l.objs,p=0;p<d.length;p++)this._makeEditable(this._objectToLayer(d[p]).addTo(s),s);s.addTo(a),this._zoomToLayer(a,s,{zoom:l.zoom,pos:l.pos},!0),L.drawLocal.draw.toolbar.actions.text=this.strings.cancel,L.drawLocal.draw.toolbar.actions.title=this.strings.drawCancelTitle,L.drawLocal.draw.toolbar.buttons.polyline=this.strings.polylineTitle,L.drawLocal.draw.toolbar.buttons.polygon=this.strings.polygonTitle,L.drawLocal.draw.toolbar.buttons.marker=this.strings.markerTitle,L.drawLocal.draw.handlers.marker.tooltip.start=this.strings.markerTooltip,L.drawLocal.draw.handlers.polyline.tooltip.start=this.strings.polylineStartTooltip,L.drawLocal.draw.handlers.polyline.tooltip.cont=this.strings.polylineContinueTooltip,L.drawLocal.draw.handlers.polyline.tooltip.end=this.strings.polylineEndTooltip,L.drawLocal.draw.handlers.polygon.tooltip.start=this.strings.polygonStartTooltip,L.drawLocal.draw.handlers.polygon.tooltip.cont=this.strings.polygonContinueTooltip,L.drawLocal.draw.handlers.polygon.tooltip.end=this.strings.polygonEndTooltip;var c=new L.Control.Draw({position:"topleft",draw:{marker:!0,polyline:{showLength:!1,guidelineDistance:10,shapeOptions:{color:"#000000",weight:5,opacity:.7}},polygon:this.options.enablePolygons?{showArea:!1,guidelineDistance:10,shapeOptions:{color:"#000000",weight:3,opacity:.7,fillOpacity:this.options.polygonOpacity}}:!1,rectangle:!1,circle:!1},edit:{featureGroup:s,edit:!1,remove:!1}});if(this._eachParamHandler(function(t){t.initDrawControl&&t.initDrawControl(c)}),a.addControl(c),a.on("draw:created",function(t){var e=t.layer;this._eachParamHandler(function(t){t.initLayer&&t.initLayer(e)},this,e),this._makeEditable(e,s),s.addLayer(e),"marker"===t.layerType&&e.openPopup()},this),this.options.editorCloseButtons){var h=L.functionButton("<b>"+this.strings.apply+"</b>",{position:"topleft",title:this.strings.applyTitle});if(h.on("clicked",function(){var t=this._getBBCode(a,s);i.close(),r&&this._updateMapInTextArea(r,e,t),o&&o.call(n,t)},this),a.addControl(h),this.options.shareTag&&this.options.uploadButton&&this._upload){var u=L.functionButton(this.strings.upload,{position:"topleft",title:this.strings.uploadTitle});u.on("clicked",function(){this._upload(i,s.getLayers().length?this._getBBCode(a,s):!1,function(t){i.close();var a="["+this.options.shareTag+"]"+t+"[/"+this.options.shareTag+"]";r&&this._updateMapInTextArea(r,e,a),o&&o.call(n,a)})},this),a.addControl(u)}var m=L.functionButton(this.strings.cancel,{position:"topright",title:this.strings.cancelTitle});m.on("clicked",function(){i.close(),o&&o.call(n,null)},this),a.addControl(m)}if(this.options.helpButton){var g=L.functionButton('<span style="font-size: 18px; font-weight: bold;">?</span>',{position:"topright",title:this.strings.helpTitle});g.on("clicked",function(){for(var t="",e=this.strings.helpContents,o="1.0.0",n="resizable,dialog,scrollbars,height="+this.options.windowHeight+",width="+this.options.windowWidth,i=window.open("","mapbbcode_help",n),a=0;a<e.length;a++)t+=a?"#"===e[a].substr(0,1)?"<h2>"+e[a].replace(/^#\s*/,"")+"</h2>":"<p>"+e[a]+"</p>":"<h1>"+e[0]+"</h1>";t=t.replace("{version}",o),t+='<div id="close"><input type="button" value="'+this.strings.close+'" onclick="javascript:window.close();"></div>';var r="<style>body { font-family: sans-serif; font-size: 12pt; } p { line-height: 1.5; } h1 { text-align: center; font-size: 18pt; } h2 { font-size: 14pt; } #close { text-align: center; margin-top: 1em; }</style>";i.document.open(),i.document.write(r),i.document.write(t),i.document.close(),i.onkeypress=function(t){var e=window.event?(t||window.event).which:t.keyCode;27==e&&i.close()}},this),a.addControl(g)}return this.options.confirmFormSubmit&&this._addSubmitHandler(a,s),{_ui:this,map:a,close:function(){var t=this.getBBCode();this.map=null,this._ui=null,this.getBBCode=function(){return t},i.close()},getBBCode:function(){return this._ui._getBBCode(a,s)},updateBBCode:function(t,e){var o=window.MapBBCodeProcessor.stringToObjects(t),n=o.objs;s.clearLayers(),a.removeLayer(s);for(var i=0;i<n.length;i++)this._ui._makeEditable(this._ui._objectToLayer(n[i]).addTo(s),s);a.addLayer(s),e||this._ui._zoomToLayer(a,s,{zoom:o.zoom,pos:o.pos},!0)},zoomToData:function(){this._ui.zoomToLayer(a,s)}}}},editorWindow:function(t,e,o){window.storedMapBB={bbcode:t,callback:e,context:o,caller:this};var n=this.options.windowFeatures,i="height="+this.options.windowHeight+",width="+this.options.windowWidth,a=this.options.windowPath,r="/"==a.substring(a.length-1)?a+"mapbbcode-window.html":a;window.open(r,"mapbbcode_editor",n+","+i)}}),window.MapBBCode.include({_getEndpoint:function(){var t=this.options.externalEndpoint;if(!t||"http"!==t.substring(0,4))return"";var e=t.substring(t.length-1);return"/"!=e&&"="!=e&&(t+="/"),t},_ajax:function(t,e,o,n){var i;if(window.XMLHttpRequest?i=new window.XMLHttpRequest:window.ActiveXObject&&(i=new window.ActiveXObject("MSXML2.XMLHTTP.3.0")),i){i.onreadystatechange=function(){4==i.readyState&&e.call(o,200==i.status?!1:i.status||499,i.responseText)};try{n?(i.open("POST",t,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(n)):(i.open("GET",t,!0),i.send(null))}catch(a){e.call(o,399)}}},showExternal:function(element,id,callback,context){var endpoint=this._getEndpoint();if(this.options.shareTag&&endpoint&&id){var errorDiv=this._createMapPanel(element);errorDiv.style.display="table";var cell=document.createElement("div");cell.style.display="table-cell",cell.style.width="100%",cell.style.backgroundColor="#ddd",cell.style.textAlign="center",cell.style.verticalAlign="middle",cell.innerHTML=this.strings.sharedCodeLoading.replace("{url}",endpoint+id),errorDiv.appendChild(cell);var showMap=function(error,content){var show,result,derror=!1;if(error?derror=!0:result=eval("("+content+")"),error||result.error||!result.bbcode)cell.innerHTML=this.strings.sharedCodeError.replace("{url}",endpoint+id),show={close:function(){errorDiv.close()}};else if(show=this.show(element,result.bbcode),result.title,show){var map=show.map;if(!this.options.outerLinkTemplate){var outer=L.functionButton(window.MapBBCode.buttonsImage,{position:"topright",bgPos:[52,0],title:this.strings.outerTitle});outer.on("clicked",function(){window.open(endpoint+id,"mapbbcode_outer")},this),map.addControl(outer)}if(L.ExportControl){var ec=new L.ExportControl({name:this.strings.exportName,title:this.strings.exportTitle,endpoint:endpoint,codeid:id});map.addControl(ec)}}callback&&callback.call(context||this,show)};this._ajax(endpoint+id+"?api=1",showMap,this)}},_upload:function(mapDiv,bbcode,callback){var outerDiv=document.createElement("div");outerDiv.style.display="table";try{outerDiv.style.backgroundColor="rgba(0, 0, 0, 0.8)"}catch(err){outerDiv.style.backgroundColor="black"}outerDiv.style.zIndex=2e3,outerDiv.style.position="absolute",outerDiv.style.left=outerDiv.style.right=outerDiv.style.top=outerDiv.style.bottom=0,outerDiv.style.width=outerDiv.style.height="100%",mapDiv.appendChild(outerDiv);var back=document.createElement("div");back.style.width=back.style.height="100%",back.style.textAlign="center",back.style.color="white",back.style.verticalAlign="middle",back.style.display="table-cell",back.style.cursor="default";var stop=L.DomEvent.stopPropagation;L.DomEvent.on(back,"click",stop).on(back,"mousedown",stop).on(back,"dblclick",stop),outerDiv.appendChild(back);var cancel=document.createElement("input"),endpoint=this._getEndpoint();if(bbcode){var message=document.createElement("div");message.innerHTML=this.strings.uploading+"...",back.appendChild(message),this._ajax(endpoint+"save?api=1",function(error,content){if(error)message.innerHTML=this.strings.uploadError+": "+error;else{var result=eval("("+content+")");if(result.error||!result.codeid)message.innerHTML=this.strings.uploadError+":<br>"+result.error;else{message.innerHTML=this.strings.uploadSuccess+':<br><a href="'+result.editurl+'" target="editmap" style="line-height: 40px; color: #ccf">'+result.editurl+"</a>";var sthis=this;cancel.onclick=function(){mapDiv.removeChild(outerDiv),callback.call(sthis,result.codeid)}}}},this,"title=&bbcode="+encodeURIComponent(bbcode).replace(/%20/g,"+"))}else{var descDiv=document.createElement("div");descDiv.innerHTML=this.strings.sharedFormHeader,back.appendChild(descDiv);var inputDiv=document.createElement("div"),url=document.createElement("input");url.type="text",url.size=40,inputDiv.appendChild(url);var urlBtn=document.createElement("input");urlBtn.type="button",urlBtn.value=this.strings.apply,inputDiv.appendChild(urlBtn),back.appendChild(inputDiv),url.focus();var errorDiv=document.createElement("div");errorDiv.style.color="#fcc",errorDiv.style.display="none",back.appendChild(errorDiv);var checkCode=function(){errorDiv.style.display="none";var t=new RegExp("(?:/|^)([a-z]+)\\s*$").exec(url.value);if(t){var e=t[1];this._ajax(endpoint+e+"?api=1",function(t,o){t?(errorDiv.innerHTML=this.strings.sharedFormError,errorDiv.style.display="block"):o.substr(0,15).indexOf('"error"')>0?(url.value="",errorDiv.innerHTML=this.strings.sharedFormInvalidCode,errorDiv.style.display="block"):(mapDiv.removeChild(outerDiv),callback.call(this,e))},this)}};L.DomEvent.on(urlBtn,"click",checkCode,this),L.DomEvent.on(url,"keypress",function(t){var e=window.event?(t||window.event).which:t.keyCode;13==e?checkCode.call(this):27==e&&mapDiv.removeChild(outerDiv)},this)}cancel.type="button",cancel.value=this.strings.close,cancel.style.marginTop="30px",cancel.onclick=function(){mapDiv.removeChild(outerDiv)},back.appendChild(cancel)}}),"objectParams"in window.MapBBCode||(window.MapBBCode.objectParams=[]),window.MapBBCode.objectParams.push({lineColors:{def:"#0022dd",blue:"#0022dd",red:"#bb0000",green:"#007700",brown:"#964b00",purple:"#800080",black:"#000000"},reKeys:new RegExp("^(blue|red|green|brown|purple|black)$"),applicableTo:function(t){return t instanceof L.Polygon||t instanceof L.Polyline},objectToLayer:function(t,e){var o=this.lineColors,n=e.length>0&&e[0]in o?o[e[0]]:o.def;t.options.color=n,t instanceof L.Polygon&&(t.options.fillColor=n)},layerToObject:function(t,e){return t._colorName?this.lineColors[t._colorName]!==this.lineColors.def?[t._colorName]:[]:e},initLayer:function(){},initDrawControl:function(t){t.options.draw.polyline.shapeOptions.color=this.lineColors.def,t.options.draw.polygon.shapeOptions.color=this.lineColors.def},createEditorPanel:function(t){var e,o=document.createElement("div"),n=[],i=this.lineColors;for(e in i)"string"==typeof i[e]&&"#"===i[e].substring(0,1)&&n.push(e);n=n.sort(),o.style.width=10+20*n.length+"px",o.textAlign="center";for(var a=function(e){var n=window.event&&window.event.srcElement||e.target||e.srcElement,i=n.style;if("white"==i.borderColor){t.setStyle({color:i.backgroundColor,fillColor:i.backgroundColor}),t._colorName=n._colorName;for(var a=o.childNodes,r=0;r<a.length;r++)a[r].style.borderColor="white";i.borderColor="#aaa"}},r=0;r<n.length;r++)if("def"!==n[r]){var s=document.createElement("div");s._colorName=n[r],s.style.width="16px",s.style.height="16px",s.style.cssFloat="left",s.style.styleFloat="left",s.style.marginRight="3px",s.style.marginBottom="5px",s.style.cursor="pointer";var l=i[n[r]];s.style.backgroundColor=l,s.style.borderWidth="3px",s.style.borderStyle="solid",s.style.borderColor=l==t.options.color?"#aaa":"white",s.onclick=a,o.appendChild(s)}var d=document.createElement("div");return d.style.clear="both",o.appendChild(d),o}}),L.LetterIcon=L.Icon.extend({options:{className:"leaflet-div-icon",color:"black",radius:11},initialize:function(t,e){this._letter=t,L.setOptions(this,e)},createIcon:function(){var t=this.options.radius,e=2*t+1,o=document.createElement("div");return o.innerHTML=this._letter,o.className="leaflet-marker-icon",o.style.marginLeft=-t-2+"px",o.style.marginTop=-t-2+"px",o.style.width=e+"px",o.style.height=e+"px",o.style.borderRadius=t+2+"px",o.style.borderWidth="2px",o.style.borderColor="white",o.style.fontSize="10px",o.style.fontFamily="sans-serif",o.style.fontWeight="bold",o.style.textAlign="center",o.style.lineHeight=e+"px",o.style.color="white",o.style.backgroundColor=this.options.color,this._setIconStyles(o,"icon"),o},createShadow:function(){return null}}),L.letterIcon=function(t,e){return new L.LetterIcon(t,e)},L.PopupIcon=L.Icon.extend({options:{width:150},initialize:function(t,e){L.Icon.prototype.initialize.call(this,e),this._text=t},createIcon:function(){var t=document.createElement("div"),e=document.createElement("div"),o=this.options.width;t.style.position="absolute",e.style.position="absolute",e.style.width=o+"px",e.style.bottom="-3px",e.style.left=-o/2+"px";var n=document.createElement("div");n.innerHTML=this._text,n.style.textAlign="center",n.style.lineHeight="1.2",n.style.backgroundColor="white",n.style.boxShadow="0px 1px 10px rgba(0, 0, 0, 0.655)",n.style.padding="4px 7px",n.style.borderRadius="5px",n.style.margin="0 auto",n.style.display="table";var i=document.createElement("div");i.className="leaflet-popup-tip-container",i.style.width="20px",i.style.height="11px";var a=document.createElement("div");return a.className="leaflet-popup-tip",a.style.width=a.style.height="8px",a.style.marginTop="-5px",a.style.boxShadow="none",i.appendChild(a),e.appendChild(n),e.appendChild(i),t.appendChild(e),t},createShadow:function(){return null}}),L.popupIcon=function(t,e){return new L.PopupIcon(t,e)},L.Control.Search=L.Control.extend({options:{position:"topleft",title:"Nominatim Search",email:""},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-bar"),o=document.createElement("div");e.appendChild(o);var n=L.DomUtil.create("a","",o);n.href="#",n.style.width="26px",n.style.height="26px",n.style.backgroundImage="url("+this._icon+")",n.style.backgroundSize="26px 26px",n.style.backgroundRepeat="no-repeat",n.title=this.options.title;var i=L.DomEvent.stopPropagation;L.DomEvent.on(n,"click",i).on(n,"mousedown",i).on(n,"dblclick",i).on(n,"click",L.DomEvent.preventDefault).on(n,"click",this._toggle,this);var a=this._form=document.createElement("form");a.style.display="none",a.style.position="absolute",a.style.left="27px",a.style.top="0px",a.style.zIndex=-10;var r=this._input=document.createElement("input");return r.style.height="25px",r.style.border="1px solid grey",r.style.padding="0 0 0 10px",a.appendChild(r),L.DomEvent.on(a,"submit",function(){return this._doSearch(r.value),!1},this).on(a,"submit",L.DomEvent.preventDefault),e.appendChild(a),e},_toggle:function(){"block"!=this._form.style.display?(this._form.style.display="block",this._input.focus()):this._collapse()},_collapse:function(){this._form.style.display="none",this._input.value=""},_nominatimCallback:function(t){if(t&&t.length>0){var e=t[0].boundingbox;this._map.fitBounds(L.latLngBounds([[e[0],e[2]],[e[1],e[3]]]))}this._collapse()},_callbackId:0,_doSearch:function(t){var e="_l_osmgeocoder_"+this._callbackId++;window[e]=L.Util.bind(this._nominatimCallback,this);var o={q:t,format:"json",limit:1,json_callback:e};this.options.email&&(o.email=this.options.email),this._map.getBounds()&&(o.viewbox=this._map.getBounds().toBBoxString());var n="http://nominatim.openstreetmap.org/search"+L.Util.getParamString(o),i=document.createElement("script");
i.type="text/javascript",i.src=n,document.getElementsByTagName("head")[0].appendChild(i)},_icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAL/wAAC/8Bk9f7AQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAOnSURBVGiB7ZhPaBxVHMc/vxezuzlsQqQqFf+Af8CLoWgsNHjoYjazbrR4SsGbgkcPInooLb1YRdBDQRCtCp6E3NLDZmendRXpaiC1kXqwh17EixQsmxATk935edhJHELczbydskOZz+m937zf+73v/Gbe+82IqnI3YQa9gLhJBSWdVFDSSQUlnVRQ0kkFJZ174p6wXC5nVXXC9/2RXC53bWFhYS3uGN2QOIrTQqFwKJPJnAGeB54GhoNLCtwAlowxHywuLt7oO1gP+hbkOM4rwGfA/T2GbojIKdd1z+sdLPH7EuQ4zufAGyHTH8BPIrKsqn8Dk8BR4KmdAar63fb29ov1en3TOnAXrN8hx3Fe5z8x/4jI2dHR0Y/m5+fb+4w9KSKfqOohETmezWbPAW/bxu6GVYbK5fJD7Xb7V2AMWPd9/5jnedd7+NzXbrd/BB4HfBE5Xq1Wf7BadRestu1Wq3WejhiAd3uJAahUKrdE5DU6G4VR1S9tYvcisiDpUAy6S7Va7dOD+gYZ+SLoPuk4zsNR4/cisqBisfgEkAdQVTfqjqWqi6H2ZNT4vbDJ0DOh7tWo/qq662OMGbwg4IGdhoj8GdV5fX39Fp33CN/3D1vE70pkQar6S6h9JKp/Pp+fAARARK5F9e+FjaAVgjssIs9axNz1McYsW/h3JbIgz/OawM2ge7JYLD5yUN9CoZAD3gy67WazuRI1fi+sziER+ThojhpjLhzUb3h4+D2CMkhVLzQajQ2b+F3XZlMpiIg4juOp6guB6auhoaG3KpXK6n7j5+bmhprN5jvAOTo3sRVUClesV/5/a7MtTmdnZx9ttVrXCc4k4HcROWOMuVKpVG4ClEqlw8BRVT1Np1ANc1tEpqvV6s+2i9+PvqrtmZmZIyLyNTCx59JtYAN4cI99E8iF+n/5vj/teV5su11fn+C1Wm1lbGzsORF5HwhX2ePsESMi36jqYyLihsz3GmMul0ql8GHdF7F8sUKnAm+1WseMMZNBSTOiqldFZBlYcl33N+jsdJlMZgGYCbnH9vjFJigKgaiLQDFkjkXUQP761Ov1za2trROAFzKPq+qlfh+/gWRoh6mpqZF8Pn8RmA6Z+8rUQP/LNRqNjbW1tRPApZC5r0wN/EfjjigRuRwyjwNnbeYbuCDoiFpdXX0Z+DYwfa+qr9rMlQhBsJupl1T1w2w2W3Zdd91mnoFuCneCxGQoLlJBSScVlHRSQUknFZR0UkFJ564T9C+LGmRQ/iQvLwAAAABJRU5ErkJggg=="}),L.control.search=function(t){return new L.Control.Search(t)},L.ExportControl=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft",name:"Export",title:"",endpoint:"http://share.mapbbcode.org/",codeid:"",types:!1,titles:!1},onAdd:function(){var t=L.DomUtil.create("div","leaflet-bar"),e=document.createElement("div");t.appendChild(e);var o=L.DomUtil.create("a","",e);o.href="#",o.innerHTML=this.options.name,o.title=this.options.title||"",o.style.height="26px",o.style.width="auto",o.style.padding="0 4px";var n=this._variants=document.createElement("div");n.style.display="none",n.style.position="absolute",n.style.left="50px",n.style.top="0px",n.style.width="200px",n.style.padding="0 6px",n.style.backgroundColor="white",n.style.zIndex=-10,t.appendChild(n);var i=L.DomEvent.stopPropagation;return L.DomEvent.on(o,"click",i).on(o,"mousedown",i).on(o,"dblclick",i).on(o,"click",L.DomEvent.preventDefault).on(o,"click",function(){n.style.display="block"==n.style.display?"none":"block"}),this.options.types&&this.options.titles?this._updateVariants():this._ajax(this.options.endpoint+"fmtlist",function(t){t&&t.titles&&t.titles.length>0&&t.types&&t.types.length==t.titles.length&&(this.options.titles=t.titles,this.options.types=t.types,this._updateVariants())},this),t},_updateVariants:function(){var t,e=this.options.types,o=this.options.titles,n=this.options.codeid,i=this._variants;for(t=0;t<e.length;t++){t>0&&i.appendChild(document.createTextNode(" | "));var a=document.createElement("a");a.style.display="inline",a.style.width="auto",a.style.color="blue",a.style.border="none",a.style.textDecoration="none",a.innerHTML=o[t];var r=L.DomEvent.stopPropagation;n?(a.href=this.options.endpoint+n+"?format="+e[t],L.DomEvent.on(a,"click",r).on(a,"mousedown",r).on(a,"dblclick",r).on(a,"click",this._linkClick,this)):(a.href="#",a._etype=e[t],L.DomEvent.on(a,"click",r).on(a,"mousedown",r).on(a,"dblclick",r).on(a,"click",L.DomEvent.preventDefault).on(a,"click",this._linkClick,this)),i.appendChild(a)}},_linkClick:function(t){var e=window.event&&window.event.srcElement||t.target||t.srcElement;this._variants.style.display="none",this.fire("export",{fmt:e._etype})},_ajax:function(url,func,context){var http=null;window.XMLHttpRequest?http=new window.XMLHttpRequest:window.ActiveXObject&&(http=new window.ActiveXObject("MSXML2.XMLHTTP.3.0")),http.onreadystatechange=function(){if(4==http.readyState&&200==http.status){var result=eval("("+http.responseText+")");func.call(context,result)}},http.open("GET",url,!0),http.send(null)}}),L.exportControl=function(t){return new L.ExportControl(t)},window.MapBBCode.include({strings:{close:"Close",remove:"Delete",apply:"Apply",cancel:"Cancel",title:"Title",zoomInTitle:"Zoom in",zoomOutTitle:"Zoom out",applyTitle:"Apply changes",cancelTitle:"Cancel changes",fullScreenTitle:"Enlarge or shrink map panel",helpTitle:"Open help window",outerTitle:"Show this place on an external map",submitWarning:"You will lose changes to the map. Proceed?",exportName:"Export",exportTitle:"Download this map",upload:"Upload",uploadTitle:"Upload this map to an external server",uploading:"Uploading",uploadError:"Error while uploading the map",uploadSuccess:"Upload was successful. Bookmark this link to be able to edit the map",sharedFormHeader:"There are no objects to upload. Enter a MapBBCode Share map URL",sharedFormError:"This map panel has incorrect endpoint set.<br>Please contact an administrator.",sharedFormInvalidCode:"Map code is invalid",sharedCodeLoading:'Downloading <a href="{url}" target="mapbbcode_outer">a map</a>...',sharedCodeError:'Failed to download an external map<br><br><a href="{url}" target="mapbbcode_outer">Open map in a new window</a>',polylineTitle:"Draw a path",markerTitle:"Add a marker",drawCancelTitle:"Cancel drawing",markerTooltip:"Click map to place marker",polylineStartTooltip:"Click to start drawing a line",polylineContinueTooltip:"Click to continue drawing line",polylineEndTooltip:"Click the last point to finish line",polygonStartTooltip:"Click to start drawing a polygon",polygonContinueTooltip:"Click to continue drawing polygon",polygonEndTooltip:"Click the last point to close this polygon",helpContents:["Map BBCode Editor",'Since you have already activated the editor, you know the drill. There are buttons for markers and geometry, you click the map and objects appear, they have popups activated by clicking, from which you can change some properties, like color. To save the drawing click "Apply", otherwise there is a "Cancel" button.','What you should know is that you are editing not the map, but the underlying bbcode, with all restrictions it imposes. It is a text string, which you can copy and paste to different services, and edit directly. <a href="https://github.com/MapBBCode/mapbbcode/blob/master/BBCODE.md" target="mapbb">The syntax</a> of it is quite simple: <tt>[map]...[/map]</tt> tags with a list of objects as coordinate sequences and attributes. When a cursor is inside bbcode, the editor is opened with a drawing it represents, otherwise it will be empty. If you have any questions, check <a href="https://github.com/MapBBCode/mapbbcode/blob/master/FAQ.md" target="mapbb">the FAQ</a> first.',"# Navigating the map","Here are some hints for using map panels. Keyboard arrows work when a map is in focus. Shift+drag with a mouse to quickly zoom into an area, shift+zoom buttons to change zoom 3 steps at a time. Use the layer switcher at the top right corner to see the drawing on a different map. Mouse wheel is disabled in the viewer, but can be used in the editor to quickly zoom in or out. Use the button with a magnifier to navigate to a named place or a road.","# External maps",'If the feature is not disabled by administrators, you can upload your maps to a server, <a href="http://share.mapbbcode.org" target="mapbb">share.mapbbcode.org</a> by default, with an "Upload" button. If you click it not having drawn anything, it will ask for a map URL or identifier. Those are converted to <tt>[mapid]id[/mapid]</tt> bbcode, which looks like a regular map, but with an export button: users can download a drawing as GPX or CSV or in any other format. If you share an edit link for a map, others can join in, and changes will be reflected in embedded maps.',"# Plugin",'<a href="http://mapbbcode.org/" target="mapbb">MapBBCode</a> is an open source javascript library with plugins around it available for some forum and blog engines. Its goal is to make sharing maps easier. This is version {version}.']}})}(window,document);

var mapBBcode = new MapBBCode({
    windowPath: '/site/mapbbeditor',
    layers: 'OpenStreetMap',
    defaultZoom: 2,
    defaultPosition: [22, 11],
    viewWidth: 600,
    viewHeight: 300,
    fullViewHeight: 600,
    editorHeight: 400,
    windowWidth: 800,
    windowHeight: 500,
    fullFromStart: false,
    preferStandardLayerSwitcher: true
});