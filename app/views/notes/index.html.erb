<% content_for :heading do %>
  <h1><%= t ".heading", :user => @user.display_name %></h1>
  <p class="lh-lg"><%= t ".legend_html",
                         :user => link_to(@user.display_name, @user),
                         :created => tag.span(t(".legend_created"), :class => "px-2 py-1 bg-danger bg-opacity-25"),
                         :created_and_resolved => tag.span(t(".legend_created_and_resolved"), :class => "px-2 py-1 bg-warning bg-opacity-25"),
                         :resolved => tag.span(t(".legend_resolved"), :class => "px-2 py-1 bg-success bg-opacity-25"),
                         :interacted => tag.span(t(".legend_interacted"), :class => "px-2 py-1 bg-body") %></p>
<% end %>

<%= form_with :url => user_notes_path(@user), :method => :get, :data => { :turbo => true } do %>
  <div class="row gx-2 align-items-end">
    <div class="col-sm-auto mb-3">
      <%= label_tag :status, t(".status") %>
      <%= select_tag :status,
                     options_for_select([[t(".all"), "all"], [t(".open"), "open"], [t(".closed"), "closed"]], params[:status] || "all"),
                     :class => "form-select" %>
    </div>
    <div class="col-sm-auto mb-3">
      <%= submit_tag t(".apply"), :name => nil, :class => "btn btn-primary" %>
    </div>
  </div>
<% end %>

<% if @notes.empty? %>
  <h4><%= t ".no_notes" %></h4>

<% else %>
  <%= render :partial => "notes_paging_nav" %>

  <%= render :partial => "layouts/markers", :locals => { :types => %w[cross tick minus] } %>

  <table class="table table-sm note_list">
    <thead>
      <tr>
        <th></th>
        <th><%= t ".id" %></th>
        <th><%= t ".creator" %></th>
        <th><%= t ".description" %></th>
        <th><%= t ".created_at" %></th>
        <th><%= t ".last_changed" %></th>
      </tr>
    </thead>
  <% @notes.each do |note| -%>
    <%= tag.tr :class => note_list_row_class(note, @user) do %>
      <td>
        <% if !note.visible?
             alt_text_key = ".hidden"
             pin_marker = tag.use :href => "#pin-minus", :color => "gray"
           elsif note.closed?
             alt_text_key = ".closed"
             pin_marker = tag.use :href => "#pin-tick", :color => "var(--marker-green)"
           else
             alt_text_key = ".open"
             pin_marker = tag.use :href => "#pin-cross", :color => "var(--marker-red)"
           end %>
        <svg width="25" height="40" alt="<%= t alt_text_key %>">
          <%= pin_marker %>
        </svg>
      </td>
      <td><%= link_to note.id, note %></td>
      <td><%= note_author(note.author) %></td>
      <td><%= note_description(note.author, note.description, current_user&.moderator? ? note.comments.unscope(:where => :visible).first : note.comments.first).to_html %></td>
      <td><%= friendly_date_ago(note.created_at) %></td>
      <td><%= friendly_date_ago(note.updated_at) %></td>
    <% end %>
  <% end -%>
  </table>

  <%= render :partial => "notes_paging_nav" %>

<% end -%>
