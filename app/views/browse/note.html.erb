<% content_for :head do %>
<%= stylesheet_link_tag 'browse' %>
<% end %>

<% content_for :heading do %>
  <h2>
    <%= image_tag "#{@note.status}_note_marker.png", :alt => @note.status %>
    <%= t "browse.note.#{@note.status}_title", :note_name => @note.id %>
  </h2>
<% end %>

<%= render :partial => "navigation" %>

<%= render :partial => "map", :object => @note %>

<div class='column-1'>

  <% if @note.comments.find { |comment| comment.author.nil? } -%>
  <div class='browse-section common'>
    <p class="warning"><%= t "javascripts.notes.show.anonymous_warning" %></p>
  </div>
  <% end -%>

  <div class='browse-section common'>
    <div>
      <h4><%= t "browse.note.opened" %></h4>
      <p><%= note_event(@note.created_at, @note.author) %></p>
    </div>

    <% if @note.status == "closed" %>
      <div>
        <h4><%= t "browse.note.closed" %></h4>
        <p><%= note_event(@note.closed_at, @note.comments.last.author) %></p>
      </div>  
    <% elsif @note.comments.length > 1 %>
      <div>
        <h4><%= t "browse.note.last_modified" %></h4>
        <p><%= note_event(@note.updated_at, @note.comments.last.author) %></p>
      </div>  
    <% end %>

    <div id="c<%= @note.comments.first.id %>">
      <h4><%= t "browse.note.description" %></h4>
      <p><%= h(@note.comments.first.body.to_html) %></p>
    </div>

    <div>
      <h4><%= t "browse.node_details.coordinates" %></h4>
      <p class="geo"><%= link_to ("<span class='latitude'>#{number_with_delimiter(@note.lat)}</span>, <span class='longitude'>#{number_with_delimiter(@note.lon)}</span>".html_safe), {:controller => 'site', :action => 'index', :lat => h(@note.lat), :lon => h(@note.lon), :zoom => "18"} %></p>
    </div>
  </div>

  <div class='browse-section'>
    <h4><%= t "browse.note.comments" %></h4>
    <ul>
      <% @note.comments[1..-1].each do |comment| %>
        <li>
          <%= comment.body.to_html %>
          <small class="deemphasize"><%= note_event(comment.created_at, comment.author) %></small>
        </li>
      <% end %>

        <li>
          <p>
          <textarea class="comment<% if @note.closed? %> hide_unless_logged_in<% end %>" name="text" cols="20" rows="5"></textarea>
          <div class="buttons <% if @note.closed? %> hide_unless_logged_in<% end %>">
            <input type="submit" name="comment" value="<%= t 'javascripts.notes.show.comment' %>" <% if @note.closed? %>class="hidden"<% end %> data-method="POST" data-url="<%= comment_note_url(@note, :format=>:json) %>" disabled="1">
            <input type="submit" name="reopen" value="<%= t 'javascripts.notes.show.reactivate' %>" <% unless @note.closed? %>class="hidden"<% end %> data-method="POST" data-url="<%= reopen_note_url(@note, :format=>:json) %>">
            <input type="submit" name="close" value="<%= t 'javascripts.notes.show.resolve' %>" class="hide_unless_logged_in<% if @note.closed? %> hidden<% end %>" data-method="POST" data-url="<%= close_note_url(@note, :format=>:json) %>">
            <input type="submit" name="hide" value="<%= t 'javascripts.notes.show.hide' %>" class="hide_unless_moderator" data-method="DELETE" data-url="<%= note_url(@note, :format=>:json) %>">
          </div>
          </p>
        </li>
    </ul>
  </div>

</div>
