language: ruby
rvm:
  - '1.8.7'
  - '1.9.2'
  - '1.9.3'
before_install:
  - cd db/functions; make libpgosm.so; cd ../..;
before_script:
  - psql -c 'create database osm_test;' -U postgres
  - psql -c "create user osm_test with superuser password 'osm_test';" -U postgres
  - psql -d osm_test -c 'CREATE EXTENSION btree_gist;' -U osm_test
  - psql -d osm_test -c "CREATE FUNCTION maptile_for_point(int8, int8, int4) RETURNS int4 AS '`pwd`/db/functions/libpgosm', 'maptile_for_point' LANGUAGE C STRICT;" -U osm_test
  - psql -d osm_test -c "CREATE FUNCTION tile_for_point(int4, int4) RETURNS int8 AS '`pwd`/db/functions/libpgosm', 'tile_for_point' LANGUAGE C STRICT;" -U osm_test
  - cp config/example.application.yml config/application.yml
  - cp config/example.database.yml config/database.yml
  - rake db:migrate
